<!doctype html><html><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title> Reading Discord messages with RSS feed reader </title><link href=https://jarp0l.github.io/fonts.css rel=stylesheet><link title="jarp0l's blog" href=https://jarp0l.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://jarp0l.github.io/main.css media=screen rel=stylesheet><body><script>(function initTheme() {
            let body = document.getElementsByTagName("body")[0];
            if (window.localStorage.getItem("theme") !== null) {
                if (window.localStorage.getItem("theme") === "dark") {
                    body.setAttribute("data-theme", "dark");
                } else {
                    body.setAttribute("data-theme", "light");
                }
            } else {
                if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    body.setAttribute("data-theme", "dark");
                }
            }
        })();</script><div class=content><header id=header><div class=logo><a href=https://jarp0l.github.io/>jarp0l's blog</a></div><nav class=menu><ul><li><a href=/posts>/all_posts</a><li><a href=/tags>/tags</a><li><a href=/about>/about</a><li><a href=/rss.xml>/rss</a></li><div class=theme-switcher><div class=theme-button onclick=toggleTheme()><label for=cb1><svg style="enable-background:new 0 0 35 35;" viewbox="0 0 35 35" id=dayIcon version=1.1 x=0px xml:space=preserve xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink y=0px><g id=Sun><g><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5 S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5 C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6 C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9 c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44 l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5 c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06 L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2 C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29 c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7 C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5 c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z" style=fill-rule:evenodd;clip-rule:evenodd; /></g></g></svg></label><input class=toggle id=cb1 onclick=toggleTheme() type=checkbox><label class=toggle-button for=cb1></label><label for=cb1><svg enable-background="new 0 0 100 100" viewbox="0 0 100 100" id=nightIcon version=1.1 x=0px xml:space=preserve xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink y=0px><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571 C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23 c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369 c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65 c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"/></svg></label></div></div></ul></nav></header><main><article><div class=title><div class=page-header>Reading Discord messages with RSS feed reader<span style="font-size: 1.6em" class=primary-color>.</span></div><div class=meta>Posted on <time>2023-01-19</time></div></div><div class=toc><h1>Table of Contents</h1><ul><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#the-problem>The problem</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#the-idea>The idea</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#about-rss>About RSS</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#getting-into-work>Getting into work</a> <ul><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#structure>Structure</a></li><ul><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#keep-alive-py-file>keep_alive.py file</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#main-py-file>main.py file</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#the-feed-cog>The feed cog</a></ul><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#adding-to-updating-rss-feed>Adding to/updating RSS feed</a></li><ul><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#feedgen-library>feedgen library</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#mongodb-uri>MongoDB URI</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#adding-a-new-message-to-feed>Adding a new message to feed</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#updating-feed>Updating feed</a><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#publish-date-time>Publish date-time</a></ul></ul><li><a href=https://jarp0l.github.io/posts/discord-to-rss-feed/#finally>Finally...</a></ul></div><section class=body><p>TL;DR I had a bot listening to messages in Discord. If there were any messages, it would store them in a MongoDB collection and then the messages would be fetched to make an RSS feed.<h1 id=the-problem><a aria-label="Anchor link for: the-problem" class=zola-anchor href=#the-problem>The problem</a></h1><p>This was over a year ago when we had something called 'Lockdown', I wanted to stay away from Discord for the peace of my mind but as our class server in Discord was the only way to remain informed of any class updates, I was having a hard time doing that. I wanted something that was simpler, less/not distracting and with no tracking.<h1 id=the-idea><a aria-label="Anchor link for: the-idea" class=zola-anchor href=#the-idea>The idea</a></h1><p>Around the same time I had discovered about the existence of RSS, which I thought was the ideal solution for these problems.<p>I already had a bot running in our Discord server. So I decided I would implement my idea using this bot. The bot was written in Python and was running in Replit, so I just had to add the logic to listen to messages in my channel/s of choice. If there was a new message, it had to store them in MongoDB first. Then all that was left to do was to retrieve those messages from the database and structure them into XML file following the RSS 2.0 specification so that RSS readers could parse them.<h1 id=about-rss><a aria-label="Anchor link for: about-rss" class=zola-anchor href=#about-rss>About RSS</a></h1><p>First, definition from <a href=https://en.wikipedia.org/wiki/RSS>Wikipedia entry on RSS</a>:<blockquote><p>RSS (RDF Site Summary or Really Simple Syndication) is a web feed that allows users and applications to access updates to websites in a standardized, computer-readable format.</blockquote><p>RSS provides a way of viewing contents at a place aggregated from multiple sources. The sources could be news, blog posts, release notes about something, changelogs, and what not. Rather than having to go to each source and check if anything new has been added, RSS enables the power of viewing the updates from a single place.<p>The updates are served in a file which is called RSS feed. The RSS feed is just an extension from XML, and follows <a href=https://www.rssboard.org/rss-specification>RSS 2.0 specification</a>, which is the current version of the specification.<p>To view the RSS feeds, there are clients which are called RSS feed readers. The RSS feed readers parse the RSS feeds to give a pretty-looking interface for viewing the updates. There are all forms of RSS feed readers, from web-based readers to mobile apps to browser extensions.<p>This blog also has an RSS feed: <a href=/rss.xml>/rss.xml</a><h1 id=getting-into-work><a aria-label="Anchor link for: getting-into-work" class=zola-anchor href=#getting-into-work>Getting into work</a></h1><p>Before going to the actual RSS feed part, I will explain in short the structure and working of some less important parts of the codebase first (less important in terms of what this post is for).<h2 id=structure><a aria-label="Anchor link for: structure" class=zola-anchor href=#structure>Structure</a></h2><p>The application is structured in the following way:<pre style=background-color:#282a36;color:#f8f8f2;><code><span>.
</span><span>| cogs
</span><span>	|- admin.py
</span><span>	|- clean_url.py
</span><span>	|- feed.py
</span><span>	|- misc.py
</span><span>	|- ping.py
</span><span>	|- xkcd_comics.py
</span><span>| config
</span><span>	|- config.json
</span><span>	|- strings.json
</span><span>| feed
</span><span>	|- rss.xml
</span><span>| libs
</span><span>	|- config.py
</span><span>	|- my_feed.py
</span><span>|- keep_alive.py
</span><span>|- main.py
</span><span>|- poetry.lock
</span><span>|- pyproject.toml
</span><span>|- README.md
</span></code></pre><p>The entry point to the application is the <code>main.py</code> file. This file consists of mostly code for the Discord bot. However, it also calls the <code>keep_alive()</code> function from <code>keep_alive.py</code> file, which does two key things:<ol><li>running web server<li>scheduling and running the task of updating RSS feed</ol><p>I am using <code>poetry</code> to manage dependencies and virtual environment.<h3 id=keep-alive-py-file><a aria-label="Anchor link for: keep-alive-py-file" class=zola-anchor href=#keep-alive-py-file><code>keep_alive.py</code> file</a></h3><p>As I mentioned earlier, this file runs web server as well as schedules the task of updating the RSS feed.<p>The web server is used to keep the bot running as Replit puts an application (or Repl) to sleep if it is inactive for some time. I keep the bot alive by pinging the root (<code>/</code>) every few minutes using <a href=https://uptimerobot.com/>UptimeRobot</a>.<p>The web server also serves the RSS file (XML file) containing Discord messages. The RSS file is kept in the <code>feed</code> drectory (<code>feed/rss.xml</code>). So, an RSS feed reader should subscribe to either <code>/rss</code> or <code>/feed/rss.xml</code> path of the web server for RSS feed.<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span>@app</span><span style=color:#ff79c6;>.</span><span>route(</span><span style=color:#f1fa8c;>"/rss"</span><span>)
</span><span style=color:#6272a4;># another route: /feed/rss.xml
</span><span style=font-style:italic;color:#ff79c6;>def </span><span style=color:#50fa7b;>feed</span><span>():
</span><span>    </span><span style=color:#ff79c6;>with </span><span style=color:#8be9fd;>open</span><span>(</span><span style=color:#f1fa8c;>"feed/rss.xml"</span><span>) </span><span style=color:#ff79c6;>as </span><span>f:
</span><span>        xml </span><span style=color:#ff79c6;>= </span><span>f</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>readlines</span><span>()
</span><span>    r </span><span style=color:#ff79c6;>= </span><span style=color:#50fa7b;>Response</span><span>(</span><span style=font-style:italic;color:#ffb86c;>response</span><span style=color:#ff79c6;>=</span><span>xml, </span><span style=font-style:italic;color:#ffb86c;>status</span><span style=color:#ff79c6;>=</span><span style=color:#bd93f9;>200</span><span>, </span><span style=font-style:italic;color:#ffb86c;>mimetype</span><span style=color:#ff79c6;>=</span><span style=color:#f1fa8c;>"application/xml"</span><span>)
</span><span>    r</span><span style=color:#ff79c6;>.</span><span>headers[</span><span style=color:#f1fa8c;>"Content-Type"</span><span>] </span><span style=color:#ff79c6;>= </span><span style=color:#f1fa8c;>"text/xml; charset=utf-8"
</span><span>    </span><span style=color:#ff79c6;>return </span><span>r
</span></code></pre><p>This file also schedules the task of updating the RSS feed, which happens every 30 minutes:<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span style=color:#ff79c6;>from </span><span>apscheduler</span><span style=color:#ff79c6;>.</span><span>schedulers</span><span style=color:#ff79c6;>.</span><span>background </span><span style=color:#ff79c6;>import </span><span>BackgroundScheduler
</span><span style=color:#ff79c6;>from </span><span>libs</span><span style=color:#ff79c6;>.</span><span>my_feed </span><span style=color:#ff79c6;>import </span><span>MyFeed
</span><span style=color:#6272a4;># ...
</span><span>scheduler </span><span style=color:#ff79c6;>= </span><span style=color:#50fa7b;>BackgroundScheduler</span><span>()
</span><span>scheduler</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>add_job</span><span>(</span><span style=color:#50fa7b;>MyFeed</span><span>()</span><span style=color:#ff79c6;>.</span><span>update_feed, </span><span style=color:#f1fa8c;>"interval"</span><span>, </span><span style=font-style:italic;color:#ffb86c;>minutes</span><span style=color:#ff79c6;>=</span><span style=color:#bd93f9;>30</span><span>)
</span><span>scheduler</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>start</span><span>()
</span></code></pre><p>The feed updating happens once when the web server starts and also every 30 minutes.<h3 id=main-py-file><a aria-label="Anchor link for: main-py-file" class=zola-anchor href=#main-py-file><code>main.py</code> file</a></h3><p>As I stated earlier, this is the entry point to the application. It contains logic to run the bot. To make the bot modular, the commands have been divided into cogs. But we are only concerned with the <code>feed</code> cog (<code>cogs/feed.py</code>). This cog listens to messages in certain channels in Discord and stores them in a MongoDB collection.<h3 id=the-feed-cog><a aria-label="Anchor link for: the-feed-cog" class=zola-anchor href=#the-feed-cog>The <code>feed</code> cog</a></h3><p>This cog consists of the code which handles listening to messages in specific channels which are listed in the array <code>listen_channels</code> in <code>config/config.json</code> file. So, if someone posts a new message in one of those channels and it isn't from the bot itself, then this message is added to the MongoDB collection.<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span>        </span><span style=color:#ff79c6;>if </span><span>ctx</span><span style=color:#ff79c6;>.</span><span>channel</span><span style=color:#ff79c6;>.</span><span>id </span><span style=color:#ff79c6;>in </span><span>c_listen_channels:
</span><span>            </span><span style=color:#50fa7b;>MyFeed</span><span>()</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>add_feed</span><span>(ctx, ctx</span><span style=color:#ff79c6;>.</span><span>attachments)
</span></code></pre><h2 id=adding-to-updating-rss-feed><a aria-label="Anchor link for: adding-to-updating-rss-feed" class=zola-anchor href=#adding-to-updating-rss-feed>Adding to/updating RSS feed</a></h2><h3 id=feedgen-library><a aria-label="Anchor link for: feedgen-library" class=zola-anchor href=#feedgen-library><code>feedgen</code> library</a></h3><p>For the ease of creating RSS feed, I used a Python library called <code>feedgen</code> (<a href=https://feedgen.kiesow.be/>link</a>). It made this process a lot easier as I did not have to deal with XML myself.<p>In the <code>libs/my_feed.py</code> file, the class <code>MyFeed</code> extends the <code>FeedGenerator</code> class from <code>feedgen</code>. Its constuctor initializes the MongoDB client along with preparing information like feed title, subtitle, logo, etc.<h3 id=mongodb-uri><a aria-label="Anchor link for: mongodb-uri" class=zola-anchor href=#mongodb-uri>MongoDB URI</a></h3><p>The MongoDB URI (or connection string URI) is kept as an environment variable with key <code>MONGODB_URI</code>. The URI has the following format:<pre style=background-color:#282a36;color:#f8f8f2;><code><span>mongodb://[username:password@]host1[:port1][,...hostN[:portN]][/[defaultauthdb][?options]]
</span></code></pre><p>The URI in this format consists of all the necessary fields like username, password, host and DB name. Refer to the official docs for detailed explanation: https://www.mongodb.com/docs/manual/reference/connection-string/<h3 id=adding-a-new-message-to-feed><a aria-label="Anchor link for: adding-a-new-message-to-feed" class=zola-anchor href=#adding-a-new-message-to-feed>Adding a new message to feed</a></h3><p>If the bot detects any message in Discord, the <code>add_feed</code> method of <code>MyFeed</code> class is called with the arguments message context and attachment (if any). A feed dictionary is constructed with the following values:<ul><li><code>message_url</code>: message url in Discord<li><code>channel_name</code>: name of channel where the message was posted<li><code>message</code>: the message posted<li><code>author</code>: the name of author of the message<li><code>publish_date</code>: The date, time and timezone in UTC+0 of the moment of adding the feed</ul><pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span>new_update </span><span style=color:#ff79c6;>= </span><span>{
</span><span>            </span><span style=color:#f1fa8c;>"message_url"</span><span>: </span><span style=font-style:italic;color:#8be9fd;>f</span><span style=color:#f1fa8c;>"https://discord.com/channels/758544148121780226/</span><span>{channel_id}</span><span style=color:#f1fa8c;>/</span><span>{message_id}</span><span style=color:#f1fa8c;>"</span><span>,
</span><span>            </span><span style=color:#f1fa8c;>"channel_name"</span><span>: channel_name,
</span><span>            </span><span style=color:#f1fa8c;>"message"</span><span>: message,
</span><span>            </span><span style=color:#f1fa8c;>"author"</span><span>: author,
</span><span>            </span><span style=color:#f1fa8c;>"publish_date"</span><span>: str_date,
</span><span>        }
</span></code></pre><p>I did not directly generate the RSS feed. First I inserted the dictionary into a MongoDB collection and then called the <code>update_feed</code> method to generate the feed.<p>Inserting a new document into MongoDB collection:<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span style=color:#ff79c6;>from </span><span>pymongo </span><span style=color:#ff79c6;>import </span><span>MongoClient
</span><span style=color:#6272a4;># ...
</span><span>s_mongodb </span><span style=color:#ff79c6;>= </span><span>os</span><span style=color:#ff79c6;>.</span><span>environ[</span><span style=color:#f1fa8c;>"MONGODB_URI"</span><span>]
</span><span style=color:#6272a4;># ...
</span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>mongo_client </span><span style=color:#ff79c6;>= </span><span style=color:#50fa7b;>MongoClient</span><span>(s_mongodb, </span><span style=font-style:italic;color:#ffb86c;>tls</span><span style=color:#ff79c6;>=</span><span style=color:#bd93f9;>True</span><span>)
</span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>server_db </span><span style=color:#ff79c6;>= </span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>mongo_client[os</span><span style=color:#ff79c6;>.</span><span>environ[</span><span style=color:#f1fa8c;>"mongodb_name"</span><span>]]
</span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>updates </span><span style=color:#ff79c6;>= </span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>server_db[os</span><span style=color:#ff79c6;>.</span><span>environ[</span><span style=color:#f1fa8c;>"collection_name"</span><span>]]
</span><span style=color:#6272a4;># ...
</span><span>
</span><span style=color:#6272a4;># in add_feed(...):
</span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>updates</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>insert_one</span><span>(new_update)
</span></code></pre><p>Data in MongoDB: <img alt=2c091251d9e46b8eeed5984153428bb5.png src=https://jarp0l.github.io/posts/discord-to-rss-feed/2c091251d9e46b8eeed5984153428bb5.png><h3 id=updating-feed><a aria-label="Anchor link for: updating-feed" class=zola-anchor href=#updating-feed>Updating feed</a></h3><p>The RSS feed is updated by calling the <code>update_feed</code> method of the <code>MyFeed</code> class. This method iterates through all the documents in the MongoDB collection and then prepares the RSS feed file. It uses <code>find()</code> function to get all the documents in the collection.<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span>    </span><span style=font-style:italic;color:#ff79c6;>def </span><span style=color:#50fa7b;>update_feed</span><span>(</span><span style=font-style:italic;color:#ffb86c;>self</span><span>):
</span><span>        </span><span style=color:#ff79c6;>for </span><span>entry </span><span style=color:#ff79c6;>in </span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span>updates</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>find</span><span>():
</span><span>			fe </span><span style=color:#ff79c6;>= </span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>add_entry</span><span>()
</span><span>			</span><span style=color:#6272a4;># get message, message channel, author, date-time from db
</span><span>            </span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>rss_str</span><span>(</span><span style=font-style:italic;color:#ffb86c;>pretty</span><span style=color:#ff79c6;>=</span><span style=color:#bd93f9;>True</span><span>)  </span><span style=color:#6272a4;># Get the RSS feed as string
</span><span>            </span><span style=color:#bd93f9;>self</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>rss_file</span><span>(</span><span style=color:#f1fa8c;>"feed/rss.xml"</span><span>)  </span><span style=color:#6272a4;># Write the RSS feed to a file
</span></code></pre><p>Generated RSS feed: <img alt=e481608079311f6495374e72427e9b7e.png src=https://jarp0l.github.io/posts/discord-to-rss-feed/e481608079311f6495374e72427e9b7e.png><h3 id=publish-date-time><a aria-label="Anchor link for: publish-date-time" class=zola-anchor href=#publish-date-time>Publish date-time</a></h3><p>I was using the <code>datetime</code> and <code>zoneinfo</code> for the date, time and timezone, but I have moved to using <a href=https://pendulum.eustace.io/><code>pendulum</code></a> now.<p>Code snippet to get string representation of the date-time of the moment a Discord message is being added to database:<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span>        publish_date </span><span style=color:#ff79c6;>= </span><span>pendulum</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>now</span><span>(</span><span style=font-style:italic;color:#ffb86c;>tz</span><span style=color:#ff79c6;>=</span><span style=color:#f1fa8c;>"UTC"</span><span>)
</span><span>        str_date </span><span style=color:#ff79c6;>= </span><span>publish_date</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>format</span><span>(</span><span style=color:#f1fa8c;>"YYYY-MM-DD HH:mm:ss ZZ"</span><span>)
</span></code></pre><p>Code snippet for converting date-time from MongoDB document:<pre class=language-py data-lang=py style=background-color:#282a36;color:#f8f8f2;><code class=language-py data-lang=py><span>            fe</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>published</span><span>(
</span><span>                pendulum</span><span style=color:#ff79c6;>.</span><span style=color:#50fa7b;>from_format</span><span>(
</span><span>                    entry[</span><span style=color:#f1fa8c;>"publish_date"</span><span>], </span><span style=color:#f1fa8c;>"YYYY-MM-DD HH:mm:ss ZZ"</span><span>, </span><span style=font-style:italic;color:#ffb86c;>tz</span><span style=color:#ff79c6;>=</span><span style=color:#f1fa8c;>"UTC"
</span><span>                )
</span><span>            ) 
</span></code></pre><h1 id=finally><a aria-label="Anchor link for: finally" class=zola-anchor href=#finally>Finally...</a></h1><p>I have put together a diagram to show the core working process of this system: <img alt="diagram showing the architecture of system" src=./architecture.jpg width=512><p>The code for this is in GitHub at: <a href=https://github.com/jarp0l/076bei-bot>jarp0l/076bei-bot</a><p>Disclaimer: I recently updated some stuffs in the code, but have not tested if the new changes work as expected. Also, the code is untested for bugs and exceptions as it was written quite a long time ago. As the bot was written before slash commands were adopted, it doesn't support them.</section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=https://jarp0l.github.io/tags/rss/>rss</a><li><a href=https://jarp0l.github.io/tags/fun/>fun</a></ul></nav></div></article></main><footer><div class=theme-info><p>Powered by <a rel="noopener noreferrer" href=https://www.getzola.org/ target=_blank>Zola</a></div></footer></div><script src=https://jarp0l.github.io/js/main.js></script>